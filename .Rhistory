axis.ticks = element_blank())+
facet_wrap(vars(year, sediment, RCP), nrow = 2)
ggplot(data = railpred, aes(fill = railprob))+
geom_sf(colour = NULL)+
labs(y = NULL, x = NULL, title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())+
facet_wrap(vars(year, sediment, RCP), nrow = 2)
ggplot(data = railpred, aes(fill = railprob))+
geom_sf()+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())+
facet_wrap(vars(year, sediment, RCP), nrow = 2)
ggplot(data = railpred, aes(fill = railprob))+
geom_sf(color = NA)+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())+
facet_wrap(vars(year, sediment, RCP), nrow = 2)
plot(perc_summ_inund_fut)
cellStats(perc_summ_inund_fut, quantile)
?cellStats
cellStats(perc_summ_inund_fut, stat = "mean")
data.frame(cellStats(perc_summ_inund_fut, c(quantile, mean)))
cellStats(perc_summ_inund_fut, stat = c("mean", "min"))
cellStats(perc_summ_inund_fut, stat = "mean")
hist(perc_summ_inund_fut)
ggplot(perc_summ_inund_fut)+geom_histogram()
# Calculate Inundation from raster elevation and LA Water level data ##
# Elevation is NAVD88 Based on report Need to confirm with Karen (unit is meters)
elv_m_2012<- raster("WARMER/Newport_DEM_m_2012.TIF")
#water level data NAVD88, Unit is feet so will need to conver to meters
lev_2012<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2012.csv") %>%
mutate(lev_m = Verified..ft.*0.3048)%>% #convert to m
dplyr::select(1,2,6) %>%
unite(date, 1,2, sep = " ") #make single date column
lev_2012$date<-ymd_hm(lev_2012$date) #convert to date object
lev_2012$season<-ifelse(month(lev_2012$date)%in% c(1,2,3,10,11,12), "W", "S") #add column for season
inun_metrics_12 <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/2012_inun_metrics.grd")
load("SPSP_MAX_model.rda")
lev_2011<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2011.csv")
lev_2013<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2013.csv")
lev_2014<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2014.csv")
lev_2015<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2015.csv")
lev_2016<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2016.csv")
lev_2017<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2017.csv")
lev_2018<-read.csv("LAWaterLevel/CO-OPS_9410660_wl_2018.csv")
#water level in MSL to be used with Matts Delft3D raster. 2011 is a normal year and 2015 is an el nino year
lev_2011_MSL <- read.csv("LAWaterLevel/CO-OPS_9410660_wl_2011_MSL.csv")
lev_2015_MSL <- read.csv("LAWaterLevel/CO-OPS_9410660_wl_2015_MSL.csv")
tidy_water_level <- function(timeseries){
timeseries <-  timeseries %>%
mutate(lev_m = Verified..ft.*0.3048)%>% #convert to m
dplyr::select(1,2,6) %>%
unite(date, 1,2, sep = " ") #make single date column
timeseries$date<-ymd_hm(timeseries$date) #convert to date object
timeseries$season<-ifelse(month(timeseries$date)%in% c(1,2,3,10,11,12), "W", "S") #add column for season
return(timeseries)
}
#tid water level function for the MSL csvs which for some reason are getting read in differently
tidy_water_level2 <- function(timeseries){
timeseries <-  timeseries %>%
mutate(lev_m = Verified..ft.*0.3048)%>% #convert to m
dplyr::select(1,2,6) %>%
unite(date, 1,2, sep = " ") #make single date column
timeseries$date<-mdy_hm(timeseries$date) #convert to date object
timeseries$season<-ifelse(month(timeseries$date)%in% c(1,2,3,10,11,12), "W", "S") #add column for season
return(timeseries)
}
#these levels are all NAV*88
lev_2011 <- tidy_water_level(timeseries = lev_2011)
lev_2013 <- tidy_water_level(timeseries = lev_2013)
lev_2014 <- tidy_water_level(timeseries = lev_2014)
lev_2015 <- tidy_water_level(timeseries = lev_2015)
lev_2016 <- tidy_water_level(timeseries = lev_2016)
lev_2017 <- tidy_water_level(timeseries = lev_2017)
lev_2018 <- tidy_water_level(timeseries = lev_2018)
#RCP 8.5 , 2100, normal year, MSL
lev_2011_MSL <- tidy_water_level2(timeseries = lev_2011_MSL)
lev_2100_normal_RCP8 <- lev_2011_MSL %>%
mutate(lev_m_2100 = lev_m+1.09728) %>%
dplyr::select(1,4,3)
#RCP 4.5 , 2100, normal year, MSL
lev_2100_normal_RCP4 <- lev_2011_MSL %>%
mutate(lev_m_2100 = lev_m+0.3962) %>%
dplyr::select(1,4,3)
#RCP 8.5 , 2100, el nino year, MSL
lev_2015_MSL <- tidy_water_level2(timeseries = lev_2015_MSL)
lev_2100_elnino_RCP8 <- lev_2015_MSL %>%
mutate(lev_m_2100 = lev_m+1.09728) %>%
dplyr::select(1,4,3)
#RCP 4.5 , 2100, el nino year, MSL
lev_2100_elnino_RCP4 <- lev_2015_MSL %>%
mutate(lev_m_2100 = lev_m+0.39624) %>%
dplyr::select(1,4,3)
#RCP 8.5 , 2050, normal year, MSL
lev_2050_normal_RCP8 <- lev_2011_MSL %>%
mutate(lev_m_2100 = lev_m+0.2911) %>%
dplyr::select(1,4,3)
#RCP 4.5 , 2050, normal year, MSL
lev_2050_normal_RCP4 <- lev_2011_MSL %>%
mutate(lev_m_2100 = lev_m+0.179) %>%
dplyr::select(1,4,3)
#RCP 8.5 , 2050, el nino year, MSL
lev_2050_elnino__RCP8 <- lev_2015_MSL %>%
mutate(lev_m_2100 = lev_m+0.2911) %>%
dplyr::select(1,4,3)
#RCP 4.5 , 2050, el nino year, MSL
lev_2050_elnino_RCP4 <- lev_2015_MSL %>%
mutate(lev_m_2100 = lev_m+0.179) %>%
dplyr::select(1,4,3)
#for prediction: baseline elevation from delft for the whole marsh, elevation is in MSL
elv_m_2017_baseline <- raster("C:/Users/JennyT/Documents/LitReview/UCI/working data/Delft3D/elevation_post_Mar_9_2017.TIF")
extent <- extent(c(1847000, 1850050, 661700, 666000))
elv_m_2017_baseline <- crop(elv_m_2017_baseline, extent) #crop to marsh extent
#for prediction: baseline elevation from delft for the whole marsh, elevation is in MSL
elv_m_2015_baseline <- raster("C:/Users/JennyT/Documents/LitReview/UCI/working data/Delft3D/elevation_post_Jan_11_2015.TIF")
extent <- extent(c(1847000, 1850050, 661700, 666000))
elv_m_2015_baseline <- crop(elv_m_2015_baseline, extent) #crop to marsh extent
#dredging, 0.179m SLR, elevation is in MSL
elv_m_2050_dre_RCP4 <- crop(raster("RCP4_dredging_2050/Bed_Level_2050.TIF"), extent)
#dredging, 0.2911m  SLR, elevation is in MSL
elv_m_2050_dre_RCP8 <- crop(raster("RCP8_2050_dredging/RCP8_2050_dredging.TIF"), extent)
#No dredging, 0.179m SLR, elevation is in MSL
elv_m_2050_ND_RCP4 <- crop(raster("RCP4_no_dredging_2050/RCP4_no_dredging_2050.TIF"),extent)
#No dredging, 0.2911m  SLR, elevation is in MSL
elv_m_2050_ND_RCP8 <- crop(raster("RCP8_2050_no_dredging/RCP8_2050_no_dredging.TIF"), extent)
#dredging, 0.39624m SLR, elevation is in MSL
elv_m_2100_dre_RCP4 <- crop(raster("RCP4_dredging_2100/RCP4_dredging_2100.TIF"), extent)
#dredging, 1.09728m  SLR, elevation is in MSL
elv_m_2100_dre_RCP8 <- crop(raster("RCP8_2100_dredging/RCP8_2100_dredging.TIF"), extent)
#No dredging, 0.39624m SLR, elevation is in MSL
elv_m_2100_ND_RCP4 <- crop(raster("RCP4_no_dredging_2100/RCP4_2100_no_dredging.TIF"), extent)
#No dredging, 1.09728m  SLR, elevation is in MSL
elv_m_2100_ND_RCP8 <- crop(raster("RCP8_2100_no_dredging/BL_2100.TIF"), extent)
inundation<-function(elv, lev){
temp <- elv #initate elv file
values(temp) <- 0 #replace all values with 0 for a blank raster
temp2 <- temp
temp3 <- temp
temp4 <- temp
temp5 <- temp
temp6 <- temp
for (i in 1:nrow(lev)) {
ind <- elv-lev[i,2]
temp <- (temp + (ind > 0) * ind) #mean of avg exposure height
temp2 <- (temp2 + (ind < 0) * ind) #mean of avg exposure height
temp3 <- temp3 + ind #mean inundation
temp4 <- stack(ind, temp4)
temp4 <- calc(temp4, fun=max) #max distance above water level
temp5 <- stack(ind, temp5)
temp5 <- calc(temp5, fun=min) #max depth below water level
temp6 <- temp6 + (ind < 0) #percent of annaul hours inundated
cat(i, '\t')
}
avg_ht_above_m <- temp / nrow(lev)
avg_ht_below_m <- temp2 / nrow(lev)
avg_ht <- temp3 / nrow(lev)
max_ht_above_wl <- temp4
max_depth_below_wl <- temp5
inu_pct <- temp6/8784
inu_pct_sq <- inu_pct^2
inundation_metrics <- stack(avg_ht_above_m, avg_ht_below_m, avg_ht, max_ht_above_wl, max_depth_below_wl, inu_pct, inu_pct_sq)
return(inundation_metrics)
}
#Dredge, RCP8.5, 2050, El Nino , MSL
summ_2050_dredge_RCP8_elnino <- inundation(elv = elv_m_2050_dre_RCP8, lev = lev_2050_elnino_RCP8[lev_2050_elnino_RCP8$season=="S",])
head(lev_2050_elnino_RCP8)
#RCP 8.5 , 2050, el nino year, MSL
lev_2050_elnino_RCP8 <- lev_2015_MSL %>%
mutate(lev_m_2100 = lev_m+0.2911) %>%
dplyr::select(1,4,3)
#Dredge, RCP8.5, 2050, El Nino , MSL
summ_2050_dredge_RCP8_elnino <- inundation(elv = elv_m_2050_dre_RCP8, lev = lev_2050_elnino_RCP8[lev_2050_elnino_RCP8$season=="S",])
names(summ_2050_dredge_RCP8_elnino) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_dredge_RCP8_elnino <- inundation(elv = elv_m_2050_dre_RCP8, lev = lev_2050_elnino_RCP8[lev_2050_elnino_RCP8$season=="W",])
names(wint_2050_dredge_RCP8_elnino) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_dredge_RCP8_elnino <- stack(summ_2050_dredge_RCP8_elnino, wint_2050_dredge_RCP8_elnino, elv_m_2050_dre_RCP8)
names(inun_metrics_2050_dredge_RCP8_elnino[[15]]) <- "elv_m"
inun_metrics_2050_dredge_RCP8_elnino <- writeRaster(inun_metrics_2050_dredge_RCP8_elnino, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP8_elnino_inun_metrics_.grd")
inun_metrics_2050_dredge_RCP8_elnino <- writeRaster(inun_metrics_2050_dredge_RCP8_elnino, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP8_elnino_inun_metrics_.grd", overwrite=TRUE)
summ_2050_dredge_RCP8_normal <- inundation(elv = elv_m_2050_dre_RCP8, lev = lev_2050_normal_RCP8[lev_2050_normal_RCP8$season=="S",])
names(summ_2050_dredge_RCP8_normal) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_dredge_RCP8_normal <- inundation(elv = elv_m_2050_dre_RCP8, lev = lev_2050_normal_RCP8[lev_2050_normal_RCP8$season=="W",])
names(wint_2050_dredge_RCP8_normal) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_dredge_RCP8_normal <- stack(summ_2050_dredge_RCP8_normal, wint_2050_dredge_RCP8_normal, elv_m_2050_dre_RCP8)
names(inun_metrics_2050_dredge_RCP8_normal[[15]]) <- "elv_m"
inun_metrics_2050_dredge_RCP8_normal <- writeRaster(inun_metrics_2050_dredge_RCP8_normal, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP8_normal_inun_metrics_.grd", overwrite=TRUE)
#Dredge, RCP4.5, 2050, El Nino , MSL
summ_2050_dredge_RCP4_elnino <- inundation(elv = elv_m_2050_dre_RCP4 , lev = lev_2050_elnino_RCP4[lev_2050_elnino_RCP4$season=="S",])
names(summ_2050_dredge_RCP4_elnino) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_dredge_RCP4_elnino <- inundation(elv = elv_m_2050_dre_RCP4 , lev = lev_2050_elnino_RCP4[lev_2050_elnino_RCP4$season=="W",])
names(wint_2050_dredge_RCP4_elnino) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_dredge_RCP4_elnino <- stack(summ_2050_dredge_RCP4_elnino, wint_2050_dredge_RCP4_elnino, elv_m_2050_dre_RCP4 )
names(inun_metrics_2050_dredge_RCP4_elnino[[15]]) <- "elv_m"
inun_metrics_2050_dredge_RCP4_elnino <- writeRaster(inun_metrics_2050_dredge_RCP4_elnino, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP4_elnino_inun_metrics_.grd", overwrite=TRUE)
#Dredge, RCP4.5, 2050, Normal , MSL
summ_2050_dredge_RCP4_normal <- inundation(elv = elv_m_2050_dre_RCP4 , lev = lev_2050_normal_RCP4[lev_2050_normal_RCP4$season=="S",])
names(summ_2050_dredge_RCP4_normal) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_dredge_RCP4_normal <- inundation(elv = elv_m_2050_dre_RCP4 , lev = lev_2050_normal_RCP4[lev_2050_normal_RCP4$season=="W",])
names(wint_2050_dredge_RCP4_normal) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_dredge_RCP4_normal <- stack(summ_2050_dredge_RCP4_normal, wint_2050_dredge_RCP4_normal, elv_m_2050_dre_RCP4 )
names(inun_metrics_2050_dredge_RCP4_normal[[15]]) <- "elv_m"
inun_metrics_2050_dredge_RCP4_normal <- writeRaster(inun_metrics_2050_dredge_RCP4_normal, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP4_normal_inun_metrics_.grd", overwrite=TRUE)
#NoDredge, RCP8.5, 2050, El Nino , MSL
summ_2050_nodredge_RCP8_elnino <- inundation(elv = elv_m_2050_ND_RCP8, lev = lev_2050_elnino_RCP8[lev_2050_elnino_RCP8$season=="S",])
names(summ_2050_nodredge_RCP8_elnino) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_nodredge_RCP8_elnino <- inundation(elv = elv_m_2050_ND_RCP8, lev = lev_2050_elnino_RCP8[lev_2050_elnino_RCP8$season=="W",])
names(wint_2050_nodredge_RCP8_elnino) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_nodredge_RCP8_elnino <- stack(summ_2050_nodredge_RCP8_elnino, wint_2050_nodredge_RCP8_elnino, elv_m_2050_ND_RCP8)
names(inun_metrics_2050_nodredge_RCP8_elnino[[15]]) <- "elv_m"
inun_metrics_2050_nodredge_RCP8_elnino <- writeRaster(inun_metrics_2050_nodredge_RCP8_elnino, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP8_elnino_inun_metrics_.grd", overwrite=TRUE)
#NoDredge, RCP8.5, 2050, Normal , MSL
summ_2050_nodredge_RCP8_normal <- inundation(elv = elv_m_2050_ND_RCP8, lev = lev_2050_normal_RCP8[lev_2050_normal_RCP8$season=="S",])
names(summ_2050_nodredge_RCP8_normal) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_nodredge_RCP8_normal <- inundation(elv = elv_m_2050_ND_RCP8, lev = lev_2050_normal_RCP8[lev_2050_normal_RCP8$season=="W",])
names(wint_2050_nodredge_RCP8_normal) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_nodredge_RCP8_normal <- stack(summ_2050_nodredge_RCP8_normal, wint_2050_nodredge_RCP8_normal, elv_m_2050_ND_RCP8)
names(inun_metrics_2050_nodredge_RCP8_normal[[15]]) <- "elv_m"
inun_metrics_2050_nodredge_RCP8_normal <- writeRaster(inun_metrics_2050_nodredge_RCP8_normal, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP8_normal_inun_metrics_.grd", overwrite=TRUE)
#NoDredge, RCP4.5, 2050, El Nino , MSL
summ_2050_nodredge_RCP4_elnino <- inundation(elv = elv_m_2050_ND_RCP4, lev = lev_2050_elnino_RCP4[lev_2050_elnino_RCP4$season=="S",])
names(summ_2050_nodredge_RCP4_elnino) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_nodredge_RCP4_elnino <- inundation(elv = elv_m_2050_ND_RCP4, lev = lev_2050_elnino_RCP4[lev_2050_elnino_RCP4$season=="W",])
names(wint_2050_nodredge_RCP4_elnino) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_nodredge_RCP4_elnino <- stack(summ_2050_nodredge_RCP4_elnino, wint_2050_nodredge_RCP4_elnino, elv_m_2050_ND_RCP4)
names(inun_metrics_2050_nodredge_RCP4_elnino[[15]]) <- "elv_m"
inun_metrics_2050_nodredge_RCP4_elnino <- writeRaster(inun_metrics_2050_nodredge_RCP4_elnino, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP4_elnino_inun_metrics_.grd", overwrite=TRUE)
#NoDredge, RCP4.5, 2050, Normal  , MSL
summ_2050_nodredge_RCP4_normal <- inundation(elv = elv_m_2050_ND_RCP4, lev = lev_2050_normal_RCP4[lev_2050_normal_RCP4$season=="S",])
names(summ_2050_nodredge_RCP4_normal) <- c("summ_avg_ht_above_m", "summ_avg_ht_below_m", "summ_avg_ht",
"summ_max_ht_above_wl", "summ_max_depth_below_wl", "summ_inu_pct", "summ_inu_pct_sq")
wint_2050_nodredge_RCP4_normal <- inundation(elv = elv_m_2050_ND_RCP4, lev = lev_2050_normal_RCP4[lev_2050_normal_RCP4$season=="W",])
names(wint_2050_nodredge_RCP4_normal) <- c("wint_avg_ht_above_m", "wint_avg_ht_below_m", "wint_avg_ht",
"wint_max_ht_above_wl", "wint_max_depth_below_wl", "wint_inu_pct", "wint_inu_pct_sq")
inun_metrics_2050_nodredge_RCP4_normal <- stack(summ_2050_nodredge_RCP4_normal, wint_2050_nodredge_RCP4_normal, elv_m_2050_ND_RCP4)
names(inun_metrics_2050_nodredge_RCP4_normal[[15]]) <- "elv_m"
inun_metrics_2050_nodredge_RCP4_normal <- writeRaster(inun_metrics_2050_nodredge_RCP4_normal, "C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP4_normal_inun_metrics_.grd", overwrite=TRUE)
# read in models for the veg prediction
#SPSP_MAX
load(file = "SPSP_MAX_model.rda")
#2015 baseline year for validation with Delft3d
inun_metrics_2015_delft3D  <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/__2015_delft3D_inun_metrics_.grd")
sp_max_2015_delft3D <- spsp_predict(rasterstack = inun_metrics_2015_delft3D)
#Future year, 2100
inun_metrics_2100_dre_RCP8_elnino  <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_dredge_RCP8_elnino_inun_metrics_.grd")
sp_max_2100_dre_RCP8_elnino <- spsp_predict(rasterstack = inun_metrics_2100_dre_RCP8_elnino)
#function to predict SPSP_MAX based on model for each years inundatin metrics
spsp_predict <- function(rasterstack){
sp_max_ct <- raster::predict(rasterstack, mdl_sp_max, type = "response", progress = "text")
#predict prob that its a zero
sp_max_zr <- raster::predict(rasterstack, mdl_sp_max, type = "zero", progress = "text")
#replace values with 0 or 1
values(sp_max_zr)[values(sp_max_zr)>0.5] = 0
values(sp_max_zr)[values(sp_max_zr)<=0.5 & values(sp_max_zr)>0] = 1
#final raster: if zero>0.5 then 0, else count
sp_max <- sp_max_zr * sp_max_ct
plot(sp_max)
return(sp_max)
}
#2015 baseline year for validation with Delft3d
inun_metrics_2015_delft3D  <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/__2015_delft3D_inun_metrics_.grd")
sp_max_2015_delft3D <- spsp_predict(rasterstack = inun_metrics_2015_delft3D)
#Future year, 2100
inun_metrics_2100_dre_RCP8_elnino  <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_dredge_RCP8_elnino_inun_metrics_.grd")
sp_max_2100_dre_RCP8_elnino <- spsp_predict(rasterstack = inun_metrics_2100_dre_RCP8_elnino)
inun_metrics_2100_dre_RCP8_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_dredge_RCP8_normal_inun_metrics_.grd")
sp_max_2100_dre_RCP8_normal <- spsp_predict(rasterstack = inun_metrics_2100_dre_RCP8_normal)
inun_metrics_2100_dre_RCP4_elnino <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_dredge_RCP4_elnino_inun_metrics_.grd")
sp_max_2100_dre_RCP4_elnino <- spsp_predict(rasterstack = inun_metrics_2100_dre_RCP4_elnino)
inun_metrics_2100_dre_RCP4_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_dredge_RCP4_normal_inun_metrics_.grd")
sp_max_2100_dre_RCP4_normal <- spsp_predict(rasterstack = inun_metrics_2100_dre_RCP4_normal)
inun_metrics_2100_ND_RCP8_elnino <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_ND_RCP8_elnino_inun_metrics_.grd")
sp_max_2100_ND_RCP8_elnino <- spsp_predict(rasterstack = inun_metrics_2100_ND_RCP8_elnino)
inun_metrics_2100_ND_RCP8_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_ND_RCP8_normal_inun_metrics_.grd")
sp_max_2100_ND_RCP8_normal <- spsp_predict(rasterstack = inun_metrics_2100_ND_RCP8_normal)
inun_metrics_2100_ND_RCP4_elnino <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_ND_RCP4_elnino_inun_metrics_.grd")
sp_max_2100_ND_RCP4_elnino <- spsp_predict(rasterstack = inun_metrics_2100_ND_RCP4_elnino)
inun_metrics_2100_ND_RCP4_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2100_ND_RCP4_normal_inun_metrics_.grd")
sp_max_2100_ND_RCP4_normal <- spsp_predict(rasterstack = inun_metrics_2100_ND_RCP4_normal)
#Future year, 2050
inun_metrics_2050_dre_RCP8_elnino  <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP8_elnino_inun_metrics_.grd")
sp_max_2050_dre_RCP8_elnino <- spsp_predict(rasterstack = inun_metrics_2050_dre_RCP8_elnino)
inun_metrics_2050_dre_RCP8_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP8_normal_inun_metrics_.grd")
sp_max_2050_dre_RCP8_normal <- spsp_predict(rasterstack = inun_metrics_2050_dre_RCP8_normal)
inun_metrics_2050_dre_RCP4_elnino <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP4_elnino_inun_metrics_.grd")
sp_max_2050_dre_RCP4_elnino <- spsp_predict(rasterstack = inun_metrics_2050_dre_RCP4_elnino)
inun_metrics_2050_dre_RCP4_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_dredge_RCP4_normal_inun_metrics_.grd")
sp_max_2050_dre_RCP4_normal <- spsp_predict(rasterstack = inun_metrics_2050_dre_RCP4_normal)
inun_metrics_2050_ND_RCP8_elnino <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP8_elnino_inun_metrics_.grd")
sp_max_2050_ND_RCP8_elnino <- spsp_predict(rasterstack = inun_metrics_2050_ND_RCP8_elnino)
inun_metrics_2050_ND_RCP8_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP8_normal_inun_metrics_.grd")
sp_max_2050_ND_RCP8_normal <- spsp_predict(rasterstack = inun_metrics_2050_ND_RCP8_normal)
inun_metrics_2050_ND_RCP4_elnino <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP4_elnino_inun_metrics_.grd")
sp_max_2050_ND_RCP4_elnino <- spsp_predict(rasterstack = inun_metrics_2050_ND_RCP4_elnino)
inun_metrics_2050_ND_RCP4_normal <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/_2050_ND_RCP4_normal_inun_metrics_.grd")
sp_max_2050_ND_RCP4_normal <- spsp_predict(rasterstack = inun_metrics_2050_ND_RCP4_normal)
#make stack of the %summer inundation
perc_summ_inund_fut <- stack(inun_metrics_2050_ND_RCP4_normal[[6]], inun_metrics_2050_ND_RCP4_elnino[[6]],
inun_metrics_2050_ND_RCP8_normal[[6]], inun_metrics_2050_ND_RCP8_elnino[[6]],
inun_metrics_2050_dre_RCP4_normal[[6]], inun_metrics_2050_dre_RCP4_elnino[[6]],
inun_metrics_2050_dre_RCP8_normal[[6]], inun_metrics_2050_dre_RCP8_elnino[[6]],
inun_metrics_2100_ND_RCP4_normal[[6]], inun_metrics_2100_ND_RCP4_elnino[[6]],
inun_metrics_2100_ND_RCP8_normal[[6]], inun_metrics_2100_ND_RCP8_elnino[[6]],
inun_metrics_2100_dre_RCP4_normal[[6]], inun_metrics_2100_dre_RCP4_elnino[[6]],
inun_metrics_2100_dre_RCP8_normal[[6]], inun_metrics_2100_dre_RCP8_elnino[[6]]
)
names(perc_summ_inund_fut) <- c("perc_summ_inun_2050_ND_RCP4_normal", "perc_summ_inun_2050_ND_RCP4_elnino",
"perc_summ_inun_2050_ND_RCP8_normal", "perc_summ_inun_2050_ND_RCP8_elnino",
"perc_summ_inun_2050_dre_RCP4_normal", "perc_summ_inun_2050_dre_RCP4_elnino",
"perc_summ_inun_2050_dre_RCP8_normal", "perc_summ_inun_2050_dre_RCP8_elnino",
"perc_summ_inun_2100_ND_RCP4_normal", "perc_summ_inun_2100_ND_RCP4_elnino",
"perc_summ_inun_2100_ND_RCP8_normal", "perc_summ_inun_2100_ND_RCP8_elnino",
"perc_summ_inun_2100_dre_RCP4_normal", "perc_summ_inun_2100_dre_RCP4_elnino",
"perc_summ_inun_2100_dre_RCP8_normal", "perc_summ_inun_2100_dre_RCP8_elnino")
writeRaster(perc_summ_inund_fut, "C:/Users/JennyT/Documents/LitReview/UCI/working data/perc_summ_inund_fut.grd", format = "raster")
writeRaster(perc_summ_inund_fut, "C:/Users/JennyT/Documents/LitReview/UCI/working data/perc_summ_inund_fut.grd", format = "raster", overwrite = TRUE)
perc_summ_inund_fut <- raster::stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/perc_summ_inund_fut.grd")
#make stack of spartina height
sp_max_stack_fut <- stack(sp_max_2100_dre_RCP8_elnino, sp_max_2100_dre_RCP8_normal,
sp_max_2100_dre_RCP4_elnino, sp_max_2100_dre_RCP4_normal,
sp_max_2100_ND_RCP8_elnino,sp_max_2100_ND_RCP8_normal,
sp_max_2100_ND_RCP4_elnino, sp_max_2100_ND_RCP4_normal,
sp_max_2050_dre_RCP8_elnino, sp_max_2050_dre_RCP8_normal,
sp_max_2050_dre_RCP4_elnino, sp_max_2050_dre_RCP4_normal,
sp_max_2050_ND_RCP8_elnino, sp_max_2050_ND_RCP8_normal,
sp_max_2050_ND_RCP4_elnino, sp_max_2050_ND_RCP4_normal)
names(sp_max_stack_fut) <- c("sp_max_2100_dre_RCP8_elnino", "sp_max_2100_dre_RCP8_normal",
"sp_max_2100_dre_RCP4_elnino", "sp_max_2100_dre_RCP4_normal",
"sp_max_2100_ND_RCP8_elnino", "sp_max_2100_ND_RCP8_normal",
"sp_max_2100_ND_RCP4_elnino", "sp_max_2100_ND_RCP4_normal",
"sp_max_2050_dre_RCP8_elnino", "sp_max_2050_dre_RCP8_normal",
"sp_max_2050_dre_RCP4_elnino", "sp_max_2050_dre_RCP4_normal",
"sp_max_2050_ND_RCP8_elnino", "sp_max_2050_ND_RCP8_normal",
"sp_max_2050_ND_RCP4_elnino", "sp_max_2050_ND_RCP4_normal")
writeRaster(sp_max_stack_fut, "C:/Users/JennyT/Documents/LitReview/UCI/working data/sp_max_stack_fut.grd", format = "raster", overwrite = TRUE)
sp_max_stack_fut <- raster::stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/sp_max_stack_fut.grd")
library(rasterVis)
cols <- colorRampPalette(brewer.pal(9,"YlGn"))
#plot all 8 combinations
print(rasterVis::levelplot(sp_max_stack_fut, names.attr = c("2100_dre_RCP8_elnino", "2100_dre_RCP8_normal",
"2100_dre_RCP4_elnino", "2100_dre_RCP4_normal",
"2100_ND_RCP8_elnino", "2100_ND_RCP8_normal",
"2100_ND_RCP4_elnino", "2100_ND_RCP4_normal",
"2050_dre_RCP8_elnino", "2050_dre_RCP8_normal",
"2050_dre_RCP4_elnino", "2050_dre_RCP4_normal",
"2050_ND_RCP8_elnino", "2050_ND_RCP8_normal",
"2050_ND_RCP4_elnino", "2050_ND_RCP4_normal"),
col.regions=cols,
scales=list(draw=FALSE),
layout=c(4, 4)))#remove axis ticks
#read in data showing the max height of spartina
sp_max_stack <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/sp_max_stack.grd")
#read in UNB file to make the bird data spatial
UNB <- st_read("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/UNB_Grid.shp")
#model percent of bird occupancy vs spartina metrics
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/bird_dat_inundation_baseline.RData")
#Logistic reg model with 8 weights to predict percent rail occurrence
summary(mdl_pct_rail_pres <- glm(pct_rail_pres ~ SPSP_MAX_grt60 + SPSP_MAX_95,
family = "binomial",
weights = rep(8, length (pct_rail_pres)), data = bird_dat_inundation))
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/bird_dat_inundation_2015_Delft3D_4.RData")
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/mdl_pct_rail_pres.rda")
UNB <- st_read("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/UNB_Grid.shp") %>% st_zm()
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/rail_beld_elv_veg.RData")
dat <- dat %>%
dplyr::select(UID, pct_rail_pres)
sp_max_stack_fut <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/sp_max_stack_fut.grd")
UNB <- st_read("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/UNB_Grid.shp") %>% st_zm()
UNB <- as_Spatial(UNB)
UNB <- spTransform(UNB, CRSobj = crs(elv_m_2017_baseline))
UNB <- st_as_sf(UNB)
#grt_90 (proportion of acre with spartina greater than 90cm)
bird_dat_inundation_fut<-cbind(UNB, raster::extract(x = sp_max_stack_fut, y = UNB, fun = perc_grt_90, layer = 1, nl = 16))
#function for percent greater than 90
perc_grt_90 <- function(x,...){
d <- x[!is.na(x)]
e <- (sum((d>90)/length(d)))
return(e)
}
#function for percent greater than 60
perc_grt_60 <- function(x,...){
d <- x[!is.na(x)]
e <- (sum((d>60)/length(d)))
return(e)
}
#function for 25th percentile
twentyfifthpercentile <- function(x,...){
d <- quantile(x, probs = 0.25, na.rm = TRUE)
return(d)
}
#function for 5th percentile
fifthpercentile <- function(x,...){
d <- quantile(x, probs = 0.05, na.rm = TRUE)
return(d)
}
#function for 95th percentile
nintyfifthpercentile <- function(x,...){
d <- quantile(x, probs = 0.95, na.rm = TRUE)
return(d)
}
#function for 75th percentile
seventyfifthpercentile <- function(x,...){
d <- quantile(x, probs = 0.75, na.rm = TRUE)
return(d)
}
#function for 50th percentile
medin <- function(x,...){
d <- quantile(x, probs = 0.50, na.rm = TRUE)
return(d)
}
#grt_90 (proportion of acre with spartina greater than 90cm)
bird_dat_inundation_fut<-cbind(UNB, raster::extract(x = sp_max_stack_fut, y = UNB, fun = perc_grt_90, layer = 1, nl = 16))
names(bird_dat_inundation_fut)[2:17] <- names(sp_max_stack_fut)
bird_dat_inundation_fut_tidy <- bird_dat_inundation_fut %>%
gather(sp_max_2100_dre_RCP8_elnino:sp_max_2050_ND_RCP4_normal, key = "key", value = "SPSP_MAX_grt90", na.rm = T) %>%
separate(key, c("spp", "max", "year", "sediment", "RCP", "yrtype"), sep = "_") %>%
dplyr::select(-"spp", -"max")
#MAX_95 (95% percentile value of the max spartina height)
bird_dat_inundation_fut_2<-cbind(UNB, raster::extract(x = sp_max_stack_fut, y = UNB, fun = nintyfifthpercentile, layer = 1, nl = 16))
names(bird_dat_inundation_fut_2)[2:17] <- names(sp_max_stack_fut)
bird_dat_inundation_fut_tidy_2 <- bird_dat_inundation_fut_2 %>%
gather(sp_max_2100_dre_RCP8_elnino:sp_max_2050_ND_RCP4_normal, key = "key", value = "SPSP_MAX_95", na.rm = T) %>%
separate(key, c("spp", "max", "year", "sediment", "RCP", "yrtype"), sep = "_") %>%
dplyr::select(-"spp", -"max")
bird_dat_inundation_fut_3<-cbind(UNB, raster::extract(x = sp_max_stack_fut, y = UNB, fun = perc_grt_60, layer = 1, nl = 16))
names(bird_dat_inundation_fut_3)[2:17] <- names(sp_max_stack_fut)
bird_dat_inundation_fut_tidy_3 <- bird_dat_inundation_fut_3 %>%
gather(sp_max_2100_dre_RCP8_elnino:sp_max_2050_ND_RCP4_normal, key = "key", value = "SPSP_MAX_grt60", na.rm = T) %>%
separate(key, c("spp", "max", "year", "sediment", "RCP", "yrtype"), sep = "_") %>%
dplyr::select(-"spp", -"max")
#join future sp metrics
bird_dat_inundation_fut_4 <- left_join(data.frame(bird_dat_inundation_fut_tidy),
data.frame(bird_dat_inundation_fut_tidy_2),
by = c("UID", "year", "sediment", "RCP", "yrtype"))
bird_dat_inundation_fut_4 <- left_join(bird_dat_inundation_fut_4,
data.frame(bird_dat_inundation_fut_tidy_3),
by = c("UID", "year", "sediment", "RCP", "yrtype"))
bird_dat_inundation_fut_4 <- bird_dat_inundation_fut_4 %>%
select(-c("geometry.x", "geometry.y", "geometry"))
save(bird_dat_inundation_fut_4, file = "C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/future_spartina_UNB.RData")
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/future_spartina_UNB.RData")
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/mdl_pct_rail_pres.rda")
bird_dat_inundation_fut_4$predict <- predict(mdl_pct_rail_pres, newdata = bird_dat_inundation_fut_4, type= "response")
railpred <- left_join(UNB, bird_dat_inundation_fut_4, by = "UID")
railpred <- railpred %>%
filter(!is.na(year))
save(railpred, file = "C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/railpred.RData")
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/railpred.RData")
#does the year type (el nino vs normal) make a difference
t.test(railpred$predict[railpred$yrtype=="elnino"], railpred$predict[railpred$yrtype =="normal"])
#average the two year types together to reduce the number of scenarios
railpred <- railpred %>%
data.frame() %>%
dplyr::select(-SPSP_MAX_grt90, -SPSP_MAX_95, -SPSP_MAX_grt60, -geometry) %>%
pivot_wider(names_from = yrtype, values_from = predict) %>%
mutate(railprob = (normal+elnino)/2) %>%
select(-elnino, -normal)
railpred <- left_join(UNB, railpred, by = "UID") %>%
filter(!is.na(year))
#plot the probability of rail occurrence
ggplot(data = railpred, aes(fill = railprob))+
geom_sf(color = NA)+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())+
facet_wrap(vars(year, sediment, RCP), nrow = 2)
#plot the probability of rail occurrence
d <- ggplot(data = railpred, aes(fill = railprob))+
geom_sf(color = NA)+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())+
facet_wrap(vars(year, sediment, RCP), nrow = 2)
ggsave(d, filename = "railProbFut.TIFF", dpi = 300, width = 25, height = 15, units = "cm", compression = "lzw")
plot(bird_dat_inundation_2015_Delft3D_4["predict"])
View(bird_dat_inundation_2015_Delft3D_4)
bird_dat_inundation_2015_Delft3D_4$predict <- predict(mdl_pct_rail_pres, newdata = bird_dat_inundation_2015_Delft3D_4, type= "response")
bird_dat_inundation_2015_Delft3D_4 <- left_join(UNB, bird_dat_inundation_2015_Delft3D_4, by = "UID")
plot(bird_dat_inundation_2015_Delft3D_4["predict"])
View(dat)
bird_dat_inundation_2015_Delft3D_4 <- left_join(bird_dat_inundation_2015_Delft3D_4, dat, by = "UID")
plot(bird_dat_inundation_2015_Delft3D_4["predict"])
cor(bird_dat_inundation_2015_Delft3D_4$pct_rail_pres, bird_dat_inundation_2015_Delft3D_4$predict, use = "complete.obs") #0.6584
bwplot(sp_max_stack_fut)
densityplot(sp_max_stack_fut)
View(bird_dat_inundation)
summary(mdl_pct_rail_pres)
table(bird_dat_inundation$year)
unique(bird_dat_inundation_2015_Delft3D_4)
nrow(bird_dat_inundation_2015_Delft3D_4)
save(bird_dat_inundation_2015_Delft3D_4, file = "C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/bird_dat_inundation_2015_Delft3D_4.RData")
