# Elevation is NAVD88 Based on report Need to confirm with Karen (unit is meters)
elv_m_2012<- raster("WARMER/Newport_DEM_m_2012.TIF")
inun_metrics_12 <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/2012_inun_metrics.grd")
#read in 2012 Thorne vegetation survey
veg<- read_excel("Newport_Vegetation_FINAL_K_Thorne.xlsx")
names(veg)[1] <- "Point_ID"
ID<-veg$Point_ID
#keep just % cover, max, avg height
veg<- veg[,!grepl(pattern = "MIN$", colnames(veg))]
veg<- veg[,!grepl(pattern = "^UNK", colnames(veg))]
veg<-veg %>% dplyr::select(-"QA/QC Notes", -"DODDER")
#make NAs in the veg df 0
veg[is.na(veg)]<-0
# read in Thorne 2012 elevation survey
UNB_elv<- st_read("Newport RTK GPS/6 Newport/Newport Elevation Points.shp")
UNB_elv$Point_ID<- as.character(UNB_elv$Point_ID)
# join veg to elevation so veg gets spatial information
veg<- left_join(UNB_elv, veg, by = "Point_ID") %>% st_zm()
# filter for only the pts where veg data was take
veg<- veg %>%
filter(Point_ID %in% ID)
veg<-st_transform(veg, crs = crs(elv_m_2012)) # project veg to correct crs
veg<-as_Spatial(veg) #convert to spatial data type
veg<-cbind(veg, raster::extract(x = inun_metrics_12, y = veg, layer = 1, nl = 13))
#convert to sf
veg <- st_as_sf(veg)
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5)+
labs(x= "Count", y = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank())
veg$summ_inu_pct_sq<-(veg$summ_inu_pct)^2
#SPSP_max model
mdl_sp_max <- zeroinfl(SPSP_MAX ~ summ_inu_pct + summ_inu_pct_sq | summ_inu_pct,
dist = "negbin",
data = veg,
EM = TRUE)
library(pscl)
#SPSP_max model
mdl_sp_max <- zeroinfl(SPSP_MAX ~ summ_inu_pct + summ_inu_pct_sq | summ_inu_pct,
dist = "negbin",
data = veg,
EM = TRUE)
summary(mdl_sp_max)
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5)+
labs(x= "Count", y = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5)+
labs(y= "Count", x = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data = veg, mapping = aes(x= SAPA_MAX, col = "black"))+
geom_histogram(binwidth = 5)+
labs(y= "Count", x = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5, color = "grey99")+
labs(y= "Count", x = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5, color = "grey50")+
labs(y= "Count", x = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5, color = "grey30")+
labs(y= "Count", x = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5, color = "grey70")+
labs(y= "Count", x = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
library(tidyverse)
library(lubridate)
library(raster)
library(rasterVis)
library(sf)
library(gridExtra)
library(RColorBrewer)
library(broom)
perc_summ_inund_fut <- raster::stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/perc_summ_inund_fut.grd")
plot(perc_summ_inund_fut)
data.frame(cellStats(perc_summ_inund_fut, quantile))
#convert to dataframe for better plotting and analysis
df <- as.data.frame(perc_summ_inund_fut, xy = TRUE)
names(df)[3:18] <- gsub(pattern = "perc_summ_inun_", replacement = "", x = names(df)[3:18])
df <- df %>%
pivot_longer(cols = 3:18, names_to = "scenario", values_to = "Inundation") %>%
separate(col = "scenario", into = c("Year", "Dredge", "RCP", "climate"), sep = "_") %>%
filter(climate == "normal")
ggplot(data = df, mapping = aes(y = Inundation, x = Dredge, fill = RCP))+
geom_boxplot()+
facet_wrap(vars(Year))+
labs(x = NULL)+
theme(axis.title.x = element_text(size = 25),
axis.title.y = element_text(size = 25),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
strip.background = element_rect(colour = "black", fill = "white"),
strip.text.x = element_text(colour = "black", face = "bold", size = 25),
panel.background = element_rect(fill = NA),
panel.grid.major = element_line(colour = NA),
panel.border = element_rect(linetype = "solid", fill = NA),
legend.position = c(.99, .99),
legend.justification = c("right", "top"),
legend.text = element_text(size = 15),
legend.title = element_text(size = 20))
sp_max_stack_fut <- raster::stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/sp_max_stack_fut.grd")
#convert to dataframe for better plotting and analysis
df2 <- as.data.frame(sp_max_stack_fut, xy = TRUE)
names(df2)[3:18] <- gsub(pattern = "sp_max_", replacement = "", x = names(df2)[3:18])
df2 <- df2 %>%
pivot_longer(cols = 3:18, names_to = "scenario", values_to = "Height") %>%
separate(col = "scenario", into = c("Year", "Dredge", "RCP", "climate"), sep = "_") %>%
filter(climate == "normal")
df2 <- df2 %>%
pivot_longer(cols = 3:18, names_to = "scenario", values_to = "Height") %>%
separate(col = "scenario", into = c("Year", "Dredge", "RCP", "climate"), sep = "_") %>%
filter(climate == "normal")
#convert to dataframe for better plotting and analysis
df2 <- as.data.frame(sp_max_stack_fut, xy = TRUE)
names(df2)[3:18] <- gsub(pattern = "sp_max_", replacement = "", x = names(df2)[3:18])
df2 <- df2 %>%
pivot_longer(cols = 3:18, names_to = "scenario", values_to = "Height") %>%
separate(col = "scenario", into = c("Year", "Dredge", "RCP", "climate"), sep = "_") %>%
filter(climate == "normal")
ggplot(data = df2, mapping = aes(y = Height, x = Dredge, fill = RCP))+
geom_boxplot()+
facet_wrap(vars(Year))+
labs(y = expression(paste("max ", italic("S. foliosa "), "height (cm)", sep = " ")))+
labs(x = NULL)+
theme(axis.title.x = element_text(size = 25),
axis.title.y = element_text(size = 25),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
strip.background = element_rect(colour = "black", fill = "white"),
strip.text.x = element_text(colour = "black", face = "bold", size = 25),
panel.background = element_rect(fill = NA),
panel.grid.major = element_line(colour = NA),
panel.border = element_rect(linetype = "solid", fill = NA),
legend.position = "none")
#UNB shapefile
UNB <- st_read("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/UNB_Grid.shp")
#2015
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/bird_dat_inundation_2015_Delft3D_4.RData")
names(bird_dat_inundation_2015_Delft3D_4)[5] <- "railprob2015"
ggplot(data = bird_dat_inundation_2015_Delft3D_4, aes(fill = railprob2015))+
geom_sf(color = NA)+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())
#future
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/railpred.RData")
#does the year type (el nino vs normal) make a difference
t.test(railpred$predict[railpred$yrtype=="elnino"], railpred$predict[railpred$yrtype =="normal"])
#average the two year types together to reduce the number of scenarios
railpred <- railpred %>%
data.frame() %>%
dplyr::select(-SPSP_MAX_grt90, -SPSP_MAX_95, -SPSP_MAX_grt60, -geometry) %>%
pivot_wider(names_from = yrtype, values_from = predict) %>%
mutate(railprob = (normal+elnino)/2) %>%
dplyr::select(-elnino, -normal)
railpred <- left_join(UNB, railpred, by = "UID") %>%
filter(!is.na(year))
ggplot(data = railpred, aes(fill = railprob))+
geom_sf(color = NA)+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())+
facet_grid(rows=vars(year), cols=vars(RCP, sediment))
#convert to dataframe for better plotting and analysis
df3 <- railpred
df3 <- df3 %>%
filter(yrtype == "normal")
names(df3)
ggplot(data = df3, mapping = aes(y = predict, x = sediment, fill = RCP))+
geom_boxplot()+
facet_wrap(vars(year))+
labs(y = "LFRR prob of occurrence")+
theme(axis.title.x = element_text(size = 25),
axis.title.y = element_text(size = 25),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
strip.background = element_rect(colour = "black", fill = "white"),
strip.text.x = element_text(colour = "black", face = "bold", size = 25),
panel.background = element_rect(fill = NA),
panel.grid.major = element_line(colour = NA),
panel.border = element_rect(linetype = "solid", fill = NA),
legend.position = "none")
ggplot(data = df3, mapping = aes(y = railprob, x = sediment, fill = RCP))+
geom_boxplot()+
facet_wrap(vars(year))+
labs(y = "LFRR prob of occurrence")+
theme(axis.title.x = element_text(size = 25),
axis.title.y = element_text(size = 25),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
strip.background = element_rect(colour = "black", fill = "white"),
strip.text.x = element_text(colour = "black", face = "bold", size = 25),
panel.background = element_rect(fill = NA),
panel.grid.major = element_line(colour = NA),
panel.border = element_rect(linetype = "solid", fill = NA),
legend.position = "none")
baseline <- bird_dat_inundation_2015_Delft3D_4 %>%
data.frame() %>%
dplyr::select(UID, railprob2015, pct_rail_pres)
chng <- left_join(railpred, baseline, by = "UID") %>%
mutate(Change = railprob - railprob2015)
myPalette <- colorRampPalette(brewer.pal(9, "RdBu"))
ggplot(data = chng, aes(fill = Change))+
geom_sf(color = NA)+
labs(title = "Change in Rail Probablity from 2015")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
title = element_text(size = 30),
panel.grid.major=element_line(colour="transparent"),
panel.background = element_blank(),
axis.text = element_blank(),
strip.text = element_text(size = 25),
strip.background = element_rect(fill = "grey99", colour="black"),
legend.title = element_text(size = 25),
legend.text=element_text(size=20))+
scale_fill_gradientn(colours = myPalette(100))+
facet_grid(rows=vars(year), cols=vars(RCP, sediment), labeller = as_labeller(c("RCP4" = "RCP 4.5", "RCP8" = "RCP 8.5",
"dre" = "Dredge", "ND" = "No Dredge",
"2050" = "2050", "2100" = "2100")))
summary <- chng %>%
group_by(year, RCP, sediment) %>%
summarise(mean = mean(Change, na.rm = TRUE),
firstquartile = quantile(Change, probs = 0.25, na.rm = TRUE),
thirdQualtile = quantile(Change, probs = 0.75, na.rm = TRUE))
View(summary)
perc_summ_inund_fut <- raster::stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/perc_summ_inund_fut.grd")
plot(perc_summ_inund_fut)
data.frame(cellStats(perc_summ_inund_fut, quantile))
png("summ_inund_fut.png", res = 300, width = 25, height = 15, units = "cm")
#plot all 8 combinations
print(rasterVis::levelplot(perc_summ_inund_fut, names.attr = c("2100_dre_RCP8_elnino", "2100_dre_RCP8_normal",
"2100_dre_RCP4_elnino", "2100_dre_RCP4_normal",
"2100_ND_RCP8_elnino", "2100_ND_RCP8_normal",
"2100_ND_RCP4_elnino", "2100_ND_RCP4_normal",
"2050_dre_RCP8_elnino", "2050_dre_RCP8_normal",
"2050_dre_RCP4_elnino", "2050_dre_RCP4_normal",
"2050_ND_RCP8_elnino", "2050_ND_RCP8_normal",
"2050_ND_RCP4_elnino", "2050_ND_RCP4_normal"),
scales=list(draw=FALSE),
layout=c(4, 4)))#remove axis ticks
dev.off()
densityplot(perc_summ_inund_fut)
#convert to dataframe for better plotting and analysis
df <- as.data.frame(perc_summ_inund_fut, xy = TRUE)
names(df)[3:18] <- gsub(pattern = "perc_summ_inun_", replacement = "", x = names(df)[3:18])
df <- df %>%
pivot_longer(cols = 3:18, names_to = "scenario", values_to = "Inundation") %>%
separate(col = "scenario", into = c("Year", "Dredge", "RCP", "climate"), sep = "_") %>%
filter(climate == "normal")
a <-  ggplot(data = df, mapping = aes(y = Inundation, x = Dredge, fill = RCP))+
geom_boxplot()+
facet_wrap(vars(Year))+
labs(x = NULL)+
theme(axis.title.x = element_text(size = 25),
axis.title.y = element_text(size = 25),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
strip.background = element_rect(colour = "black", fill = "white"),
strip.text.x = element_text(colour = "black", face = "bold", size = 25),
panel.background = element_rect(fill = NA),
panel.grid.major = element_line(colour = NA),
panel.border = element_rect(linetype = "solid", fill = NA),
legend.position = c(.99, .99),
legend.justification = c("right", "top"),
legend.text = element_text(size = 15),
legend.title = element_text(size = 20))
sp_max_stack_fut <- raster::stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/sp_max_stack_fut.grd")
plot(sp_max_stack_fut)
#convert to dataframe for better plotting and analysis
df2 <- as.data.frame(sp_max_stack_fut, xy = TRUE)
names(df2)[3:18] <- gsub(pattern = "sp_max_", replacement = "", x = names(df2)[3:18])
df2 <- df2 %>%
pivot_longer(cols = 3:18, names_to = "scenario", values_to = "Height") %>%
separate(col = "scenario", into = c("Year", "Dredge", "RCP", "climate"), sep = "_") %>%
filter(climate == "normal")
b <-  ggplot(data = df2, mapping = aes(y = Height, x = Dredge, fill = RCP))+
geom_boxplot()+
facet_wrap(vars(Year))+
labs(y = expression(paste("max ", italic("S. foliosa "), "height (cm)", sep = " ")))+
labs(x = NULL)+
theme(axis.title.x = element_text(size = 25),
axis.title.y = element_text(size = 25),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
strip.background = element_rect(colour = "black", fill = "white"),
strip.text.x = element_text(colour = "black", face = "bold", size = 25),
panel.background = element_rect(fill = NA),
panel.grid.major = element_line(colour = NA),
panel.border = element_rect(linetype = "solid", fill = NA),
legend.position = "none")
#UNB shapefile
UNB <- st_read("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/UNB_Grid.shp")
#2015
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/bird_dat_inundation_2015_Delft3D_4.RData")
names(bird_dat_inundation_2015_Delft3D_4)[5] <- "railprob2015"
ggplot(data = bird_dat_inundation_2015_Delft3D_4, aes(fill = railprob2015))+
geom_sf(color = NA)+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())
#future
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/FinalData/railpred.RData")
#does the year type (el nino vs normal) make a difference
t.test(railpred$predict[railpred$yrtype=="elnino"], railpred$predict[railpred$yrtype =="normal"])
#average the two year types together to reduce the number of scenarios
railpred <- railpred %>%
data.frame() %>%
dplyr::select(-SPSP_MAX_grt90, -SPSP_MAX_95, -SPSP_MAX_grt60, -geometry) %>%
pivot_wider(names_from = yrtype, values_from = predict) %>%
mutate(railprob = (normal+elnino)/2) %>%
dplyr::select(-elnino, -normal)
railpred <- left_join(UNB, railpred, by = "UID") %>%
filter(!is.na(year))
#plot the probability of rail occurrence
d <- ggplot(data = railpred, aes(fill = railprob))+
geom_sf(color = NA)+
labs(title = "Rail Probablity")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank())+
facet_grid(rows=vars(year), cols=vars(RCP, sediment))
ggsave(d, filename = "railProbFut.TIFF", dpi = 300, width = 25, height = 15, units = "cm", compression = "lzw")
#convert to dataframe for better plotting and analysis
df3 <- railpred
df3 <- df3 %>%
filter(yrtype == "normal")
c <- ggplot(data = df3, mapping = aes(y = railprob, x = sediment, fill = RCP))+
geom_boxplot()+
facet_wrap(vars(year))+
labs(y = "LFRR prob of occurrence")+
theme(axis.title.x = element_text(size = 25),
axis.title.y = element_text(size = 25),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
strip.background = element_rect(colour = "black", fill = "white"),
strip.text.x = element_text(colour = "black", face = "bold", size = 25),
panel.background = element_rect(fill = NA),
panel.grid.major = element_line(colour = NA),
panel.border = element_rect(linetype = "solid", fill = NA),
legend.position = "none")
margin = theme(plot.margin = unit(c(5,7,5,5), "mm"))
p<-arrangeGrob(
a + margin, b+ margin, c+ margin,
nrow = 3)
ggsave("figx.tiff", plot = p, dpi = 300, width = 10, height = 20, compression = "lzw")
baseline <- bird_dat_inundation_2015_Delft3D_4 %>%
data.frame() %>%
dplyr::select(UID, railprob2015, pct_rail_pres)
chng <- left_join(railpred, baseline, by = "UID") %>%
mutate(Change = railprob - railprob2015)
myPalette <- colorRampPalette(brewer.pal(9, "RdBu"))
fig <- ggplot(data = chng, aes(fill = Change))+
geom_sf(color = NA)+
labs(title = "Change in Rail Probablity from 2015")+
theme(axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
title = element_text(size = 30),
panel.grid.major=element_line(colour="transparent"),
panel.background = element_blank(),
axis.text = element_blank(),
strip.text = element_text(size = 25),
strip.background = element_rect(fill = "grey99", colour="black"),
legend.title = element_text(size = 25),
legend.text=element_text(size=20))+
scale_fill_gradientn(colours = myPalette(100))+
facet_grid(rows=vars(year), cols=vars(RCP, sediment), labeller = as_labeller(c("RCP4" = "RCP 4.5", "RCP8" = "RCP 8.5",
"dre" = "Dredge", "ND" = "No Dredge",
"2050" = "2050", "2100" = "2100")))
ggsave("fig1.tiff", plot = fig, dpi = 300, width = 20, height = 20, compression = "lzw")
ggsave("fig1.tiff", plot = fig, dpi = 300, width = 20, height = 15, compression = "lzw")
summary <- chng %>%
group_by(year, RCP, sediment) %>%
summarise(mean = mean(Change, na.rm = TRUE),
firstquartile = quantile(Change, probs = 0.25, na.rm = TRUE),
thirdQualtile = quantile(Change, probs = 0.75, na.rm = TRUE))
load("SPSP_MAX_model.rda")
summary(mdl_sp_max) #need to make this into a nice table
coefficients(mdl_sp_max)[5]
load("mdl_pct_rail_pres.rda")
summaryy(mdl_pct_rail_pres)
summary(mdl_pct_rail_pres)
#model percent of bird occupancy vs spartina metrics
load("C:/Users/JennyT/Documents/LitReview/UCI/working data/bird_dat_inundation_baseline.RData")
head
bird_dat_inundation
unique(bird_dat_inundation$year)
unique(bird_dat_inundation$UID)
perc_summ_inund_fut <- raster::stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/perc_summ_inund_fut.grd")
plot(perc_summ_inund_fut)
plot(perc_summ_inund_fut)[8:16]
plot(perc_summ_inund_fut, maxnl = 8)
plot(perc_summ_inund_fut, y = 8, maxnl = 8)
plot(perc_summ_inund_fut, y = 8:16)
plot(perc_summ_inund_fut, y = 13:16)
plot(perc_summ_inund_fut, y = c(13,15)
)
inun_metrics_12 <- stack("C:/Users/JennyT/Documents/LitReview/UCI/working data/2012_inun_metrics.grd")
#read in 2012 Thorne vegetation survey
veg<- read_excel("Newport_Vegetation_FINAL_K_Thorne.xlsx")
names(veg)[1] <- "Point_ID"
library(readxl)
#read in 2012 Thorne vegetation survey
veg<- read_excel("Newport_Vegetation_FINAL_K_Thorne.xlsx")
names(veg)[1] <- "Point_ID"
ID<-veg$Point_ID
#keep just % cover, max, avg height
veg<- veg[,!grepl(pattern = "MIN$", colnames(veg))]
veg<- veg[,!grepl(pattern = "^UNK", colnames(veg))]
veg<-veg %>% dplyr::select(-"QA/QC Notes", -"DODDER")
#make NAs in the veg df 0
veg[is.na(veg)]<-0
# read in Thorne 2012 elevation survey
UNB_elv<- st_read("Newport RTK GPS/6 Newport/Newport Elevation Points.shp")
UNB_elv$Point_ID<- as.character(UNB_elv$Point_ID)
# join veg to elevation so veg gets spatial information
veg<- left_join(UNB_elv, veg, by = "Point_ID") %>% st_zm()
# filter for only the pts where veg data was take
veg<- veg %>%
filter(Point_ID %in% ID)
veg<-st_transform(veg, crs = crs(elv_m_2012)) # project veg to correct crs
veg<-as_Spatial(veg) #convert to spatial data type
veg<-cbind(veg, raster::extract(x = inun_metrics_12, y = veg, layer = 1, nl = 13))
#convert to sf
veg <- st_as_sf(veg)
library(pscl)
ggplot(data = veg, mapping = aes(x= SAPA_MAX))+
geom_histogram(binwidth = 5, color = "grey70")+
labs(y= "Count", x = "Maximum height (cm)")+
theme(axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
title = element_text(size = 30),
panel.grid.major=element_line(colour="grey80"),
panel.background = element_blank(),
panel.border = element_rect(colour = "black", fill=NA, size=1))
var(veg$SPSP_MAX) #much much larger - probabaly want to do a zero inflated negative bionmial
mean(veg$SPSP_MAX)
veg$summ_inu_pct_sq<-(veg$summ_inu_pct)^2
#SPSP_max model
mdl_sp_max <- zeroinfl(SPSP_MAX ~ summ_inu_pct + summ_inu_pct_sq | summ_inu_pct,
dist = "negbin",
data = veg,
EM = TRUE)
summary(mdl_sp_max)
#test prediction on the data
prd <- data.frame("summ_inu_pct" = veg$summ_inu_pct, "summ_inu_pct_sq" = veg$summ_inu_pct_sq)
predict_ct <- predict(mdl_sp_max, newdata = prd, type = "response")
predict_zr <- predict(mdl_sp_max, newdata = prd, type = "zero")
compare <- data.frame("SPSP_MAX"=veg$SPSP_MAX, "ct" = predict_ct, "zr" = predict_zr)
compare$zr_binary <- as.factor(ifelse(compare$zr <=.5, 1, 0))
ggplot(data = compare, mapping = aes(x = SPSP_MAX, y = ct, col = zr_binary))+
geom_point(alpha = 1/2)+
xlim(c(0,150))+
ylim(c(0,150))
ggplot(data = veg, mapping = aes(x = summ_inu_pct, y = SPSP_MAX))+
geom_point(alpha = 1/3)+
labs(x = "Summer Inundation (%)", y = "Height (cm)", title = "Maximum S. foliosa height")+
geom_smooth(method = "glm",formula = y~x+I(x^2))
ggplot(data = veg, mapping = aes(x = summ_inu_pct, y = SPSP_MAX))+
geom_point(alpha = 1/3)+
labs(x = "Summer Inundation (%)", y = "Height (cm)", title = "Maximum S. foliosa height")+
geom_smooth(method = "glm",formula = y~x+I(x^2))+
xlim(c(0,0.5))
